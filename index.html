<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏ –æ–Ω–ª–∞–π–Ω</title>
    <style>
        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.2em;
        }

        /* –õ–û–ë–ë–ò */
        #lobby {
            text-align: center;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #4CAF50;
            color: white;
        }

        .btn-secondary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .join-section {
            margin: 30px 0;
        }

        .join-section input {
            padding: 15px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 10px;
            width: 300px;
            max-width: 80%;
        }

        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: left;
        }

        /* –ò–ì–†–û–í–ê–Ø –ö–û–ú–ù–ê–¢–ê */
        #gameRoom {
            display: none;
        }

        #gameRoom.active {
            display: block;
        }

        .room-info {
            background: #eef2ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .game-link-box {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
        }

        .game-link-box a {
            color: #2196F3;
            font-weight: bold;
            text-decoration: none;
            font-size: 18px;
        }

        .game-link-box a:hover {
            text-decoration: underline;
        }

        .status {
            font-size: 20px;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            text-align: center;
        }

        /* –ò–ì–†–û–í–û–ï –ü–û–õ–ï */
        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 20px auto;
        }

        .cell {
            aspect-ratio: 1;
            background: white;
            border: 3px solid #ddd;
            border-radius: 10px;
            font-size: 60px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .cell:hover {
            background: #f5f5f5;
            transform: scale(1.05);
        }

        .cell.x {
            color: #f44336;
            border-color: #f44336;
        }

        .cell.o {
            color: #2196F3;
            border-color: #2196F3;
        }

        /* –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –ò–ì–†–ï */
        .game-info {
            text-align: center;
            margin-top: 20px;
        }

        .symbol {
            font-weight: bold;
            font-size: 24px;
        }

        .symbol-x {
            color: #f44336;
        }

        .symbol-o {
            color: #2196F3;
        }

        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
        }

        .notification.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –§–£–¢–ï–† */
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ –ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏ –æ–Ω–ª–∞–π–Ω</h1>
        <p class="subtitle">–ò–≥—Ä–∞–π—Ç–µ —Å –¥—Ä—É–∑—å—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>

        <!-- –õ–û–ë–ë–ò -->
        <div id="lobby">
            <button id="createRoomBtn" class="btn btn-primary">
                üè† –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
            </button>
            
            <div class="join-section">
                <p style="margin: 20px 0; font-size: 18px; color: #555;">–∏–ª–∏</p>
                <input type="text" id="roomIdInput" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∫–æ–º–Ω–∞—Ç—ã">
                <button id="joinRoomBtn" class="btn btn-secondary">
                    üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                </button>
            </div>

            <div class="instructions">
                <h3>üéØ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h3>
                <ol style="margin-left: 20px; line-height: 1.8;">
                    <li>–ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É"</li>
                    <li>–°—Å—ã–ª–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞</li>
                    <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –¥—Ä—É–≥–æ–º –æ–∫–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞</li>
                    <li>–ò–≥—Ä–æ–∫ "X" —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º</li>
                    <li>–°–æ–µ–¥–∏–Ω–∏—Ç–µ 3 —Å–∏–º–≤–æ–ª–∞ –≤ —Ä—è–¥ –¥–ª—è –ø–æ–±–µ–¥—ã</li>
                </ol>
            </div>
        </div>

        <!-- –ò–ì–†–û–í–ê–Ø –ö–û–ú–ù–ê–¢–ê -->
        <div id="gameRoom">
            <div class="room-info">
                <h2 style="color: #444;">–ö–æ–º–Ω–∞—Ç–∞: <span id="roomIdDisplay">-</span></h2>
                
                <div class="game-link-box" id="gameLinkBox" style="display: none;">
                    <p style="margin-bottom: 10px; font-weight: bold;">üîó –°—Å—ã–ª–∫–∞ –¥–ª—è –¥—Ä—É–≥–∞:</p>
                    <a href="#" id="gameLink" target="_blank"></a>
                    <button id="copyLinkBtn" style="margin-top: 10px; padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                    </button>
                </div>

                <div class="status" id="gameStatus">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞...</div>
                
                <p style="font-size: 18px;">
                    –í–∞—à —Å–∏–º–≤–æ–ª: <span id="playerSymbol" class="symbol symbol-x">X</span>
                </p>
            </div>

            <!-- –ò–ì–†–û–í–û–ï –ü–û–õ–ï -->
            <div class="game-board" id="gameBoard">
                <!-- –Ø—á–µ–π–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>

            <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –ò–ì–†–ï -->
            <div class="game-info">
                <p style="font-size: 20px; margin-bottom: 15px;">
                    –°–µ–π—á–∞—Å —Ö–æ–¥–∏—Ç: <span id="currentPlayer" class="symbol symbol-x">X</span>
                </p>
                
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button id="restartBtn" class="btn" style="background: #ff9800; color: white;">
                        üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞
                    </button>
                    <button id="leaveRoomBtn" class="btn" style="background: #f44336; color: white;">
                        üö™ –ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É
                    </button>
                </div>
            </div>
        </div>

        <footer>
            <p>–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–≥—Ä—É –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–Ω–∞—Ç—ã</p>
        </footer>
    </div>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div class="notification" id="notification"></div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <script>
        class TicTacToeGame {
            constructor() {
                this.socket = io('http://localhost:3000');
                this.playerSymbol = null;
                this.roomId = null;
                this.isMyTurn = false;
                this.gameLink = null;
                
                this.initElements();
                this.initEventListeners();
                this.initSocketEvents();
                this.checkUrlForRoom();
                
                console.log('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
            }

            initElements() {
                // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                this.lobby = document.getElementById('lobby');
                this.gameRoom = document.getElementById('gameRoom');
                this.gameBoard = document.getElementById('gameBoard');
                this.notification = document.getElementById('notification');
                
                // –ö–Ω–æ–ø–∫–∏
                this.createRoomBtn = document.getElementById('createRoomBtn');
                this.joinRoomBtn = document.getElementById('joinRoomBtn');
                this.restartBtn = document.getElementById('restartBtn');
                this.leaveRoomBtn = document.getElementById('leaveRoomBtn');
                this.copyLinkBtn = document.getElementById('copyLinkBtn');
                
                // –ü–æ–ª—è –≤–≤–æ–¥–∞
                this.roomIdInput = document.getElementById('roomIdInput');
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                this.roomIdDisplay = document.getElementById('roomIdDisplay');
                this.gameStatus = document.getElementById('gameStatus');
                this.playerSymbolDisplay = document.getElementById('playerSymbol');
                this.currentPlayerDisplay = document.getElementById('currentPlayer');
                this.gameLinkElement = document.getElementById('gameLink');
                this.gameLinkBox = document.getElementById('gameLinkBox');
                
                // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
                this.createBoard();
            }

            createBoard() {
                this.gameBoard.innerHTML = '';
                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.index = i;
                    cell.addEventListener('click', () => this.makeMove(i));
                    this.gameBoard.appendChild(cell);
                }
            }

            initEventListeners() {
                // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
                this.createRoomBtn.addEventListener('click', () => {
                    this.socket.emit('createRoom');
                    this.showNotification('–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã...');
                });

                // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
                this.joinRoomBtn.addEventListener('click', () => {
                    const roomId = this.roomIdInput.value.trim().toUpperCase();
                    if (roomId) {
                        this.socket.emit('joinRoom', roomId);
                        this.showNotification(`–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ ${roomId}...`);
                    }
                });

                // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
                this.restartBtn.addEventListener('click', () => {
                    if (this.roomId) {
                        this.socket.emit('restartGame', this.roomId);
                    }
                });

                // –í—ã—Ö–æ–¥ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
                this.leaveRoomBtn.addEventListener('click', () => {
                    this.leaveRoom();
                });

                // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
                this.copyLinkBtn.addEventListener('click', () => {
                    this.copyGameLink();
                });
            }

            initSocketEvents() {
                // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
                this.socket.on('connect', () => {
                    console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É');
                });

                // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
                this.socket.on('roomCreated', (data) => {
                    this.roomId = data.roomId;
                    this.gameLink = data.gameLink;
                    
                    this.showGameRoom();
                    this.roomIdDisplay.textContent = data.roomId;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É
                    this.gameLinkElement.href = data.gameLink;
                    this.gameLinkElement.textContent = data.gameLink;
                    this.gameLinkBox.style.display = 'block';
                    
                    this.showNotification('–ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞! –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è –¥—Ä—É–≥–∞');
                    
                    // –¢–∞–∫–∂–µ –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
                    console.log('üéÆ –°—Å—ã–ª–∫–∞ –¥–ª—è –∏–≥—Ä—ã:', data.gameLink);
                });

                // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
                this.socket.on('roomJoined', (data) => {
                    this.roomId = data.roomId;
                    this.gameLink = `http://localhost:3000/?room=${data.roomId}`;
                    
                    this.showGameRoom();
                    this.roomIdDisplay.textContent = data.roomId;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É
                    this.gameLinkElement.href = this.gameLink;
                    this.gameLinkElement.textContent = this.gameLink;
                    this.gameLinkBox.style.display = 'block';
                    
                    this.showNotification(`–í—ã –≤ –∫–æ–º–Ω–∞—Ç–µ ${data.roomId}`);
                });

                // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞
                this.socket.on('assignSymbol', (symbol) => {
                    this.playerSymbol = symbol;
                    this.playerSymbolDisplay.textContent = symbol;
                    this.playerSymbolDisplay.className = `symbol symbol-${symbol.toLowerCase()}`;
                });

                // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
                this.socket.on('gameStart', (data) => {
                    this.gameStatus.textContent = '–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!';
                    this.updateBoard(data.board);
                    this.updateCurrentPlayer(data.currentPlayer);
                });

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
                this.socket.on('updateGame', (data) => {
                    this.updateBoard(data.board);
                    this.updateCurrentPlayer(data.currentPlayer);
                });

                // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
                this.socket.on('gameOver', (data) => {
                    if (data.winner === 'draw') {
                        this.gameStatus.textContent = '–ù–∏—á—å—è!';
                        this.showNotification('–ù–∏—á—å—è!');
                    } else {
                        this.gameStatus.textContent = `–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${data.winner}`;
                        this.showNotification(`–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${data.winner}!`);
                    }
                    this.updateBoard(data.board);
                });

                // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
                this.socket.on('gameRestart', (data) => {
                    this.updateBoard(data.board);
                    this.updateCurrentPlayer(data.currentPlayer);
                    this.gameStatus.textContent = '–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!';
                });

                // –û—à–∏–±–∫–∏
                this.socket.on('error', (data) => {
                    this.showNotification(data.message);
                });
            }

            checkUrlForRoom() {
                const urlParams = new URLSearchParams(window.location.search);
                const roomId = urlParams.get('room');
                
                if (roomId) {
                    this.roomIdInput.value = roomId;
                    this.showNotification(`–ù–∞–π–¥–µ–Ω–∞ –∫–æ–º–Ω–∞—Ç–∞: ${roomId}. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è"`);
                }
            }

            copyGameLink() {
                if (this.gameLink) {
                    navigator.clipboard.writeText(this.gameLink).then(() => {
                        this.showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                    }).catch(() => {
                        // –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                        const textArea = document.createElement('textarea');
                        textArea.value = this.gameLink;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        this.showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                    });
                }
            }

            makeMove(cellIndex) {
                if (!this.isMyTurn || !this.playerSymbol || !this.roomId) return;
                
                const cell = document.querySelector(`.cell[data-index="${cellIndex}"]`);
                if (cell.textContent !== '') return;
                
                this.socket.emit('makeMove', {
                    roomId: this.roomId,
                    cellIndex: cellIndex,
                    symbol: this.playerSymbol
                });
            }

            updateBoard(board) {
                const cells = document.querySelectorAll('.cell');
                cells.forEach((cell, index) => {
                    cell.textContent = board[index] || '';
                    cell.className = 'cell';
                    if (board[index] === 'X') {
                        cell.classList.add('x');
                    } else if (board[index] === 'O') {
                        cell.classList.add('o');
                    }
                });
            }

            updateCurrentPlayer(currentPlayer) {
                this.currentPlayerDisplay.textContent = currentPlayer;
                this.currentPlayerDisplay.className = `symbol symbol-${currentPlayer.toLowerCase()}`;
                this.isMyTurn = currentPlayer === this.playerSymbol;
                
                if (this.isMyTurn) {
                    this.gameStatus.textContent = '–í–∞—à —Ö–æ–¥!';
                } else {
                    this.gameStatus.textContent = '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...';
                }
            }

            showGameRoom() {
                this.lobby.style.display = 'none';
                this.gameRoom.classList.add('active');
            }

            leaveRoom() {
                this.lobby.style.display = 'block';
                this.gameRoom.classList.remove('active');
                
                this.playerSymbol = null;
                this.roomId = null;
                this.isMyTurn = false;
                this.gameLink = null;
                
                this.roomIdInput.value = '';
                this.gameLinkBox.style.display = 'none';
                this.createBoard();
                
                this.showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã');
            }

            showNotification(message, type = 'info') {
                const notification = this.notification;
                notification.textContent = message;
                
                // –¶–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                if (type === 'error') {
                    notification.style.background = '#f44336';
                } else if (type === 'success') {
                    notification.style.background = '#4CAF50';
                } else if (type === 'warning') {
                    notification.style.background = '#ff9800';
                } else {
                    notification.style.background = '#2196F3';
                }
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', () => {
            window.game = new TicTacToeGame();
        });
    </script>
</body>
</html>